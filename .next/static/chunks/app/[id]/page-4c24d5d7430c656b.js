(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{8910:function(e,t,r){Promise.resolve().then(r.bind(r,5121))},5121:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Sonification}});var i=r(7437),n=r(2265),l=r(5945),s=r(3454),o=r(5887),u=r(8578),a=r(6087),c=r(5616),d=r(1751),v=r(838);function Model(e){var t,r,l,o,a,f,m,h;let[x,p]=(0,n.useState)(new u.Vector3(((null===(t=e.size)||void 0===t?void 0:t.x)||0)/4,0,(null===(r=e.size)||void 0===r?void 0:r.z)||0)),w=(0,n.useRef)(),j=(0,n.useRef)();return(0,s.A)(t=>{var r,i,n,l,s,o,a,c,d;let{clock:v}=t;switch(j.near=.1,w.current.position.x=(null!==(n=null===(r=e.size)||void 0===r?void 0:r.x)&&void 0!==n?n:0)/2*e.currentTime.current/30,e.pcd.material.size=j.current.zoom,null===(i=e.view)||void 0===i?void 0:i.current){case"top":p(new u.Vector3(0,0,null!==(s=null===(l=e.size)||void 0===l?void 0:l.z)&&void 0!==s?s:0));break;case"bottom":p(new u.Vector3(0,0,-((null!==(a=null===(o=e.size)||void 0===o?void 0:o.z)&&void 0!==a?a:0)*4)));break;case"side":p(new u.Vector3(0,-((null!==(d=null===(c=e.size)||void 0===c?void 0:c.z)&&void 0!==d?d:0)*4),0))}}),(0,i.jsxs)("mesh",{children:[(0,i.jsx)("mesh",{ref:w,children:(0,i.jsx)(c.xu,{position:[-((null!==(m=null===(l=e.size)||void 0===l?void 0:l.x)&&void 0!==m?m:0)/4),0,-((null!==(h=null===(o=e.size)||void 0===o?void 0:o.z)&&void 0!==h?h:0)/4)],args:[((null===(a=e.size)||void 0===a?void 0:a.x)||0)/2,((null===(f=e.size)||void 0===f?void 0:f.y)||0)/2,2.5],rotation:[0,Math.PI/2,0],material:new u.MeshBasicMaterial({color:"red",side:u.DoubleSide,opacity:.5,transparent:!0})})}),(0,i.jsx)(d.M,{children:(0,i.jsx)("primitive",{object:e.pcd,scale:[.5,.5,.5]})}),(0,i.jsx)(v.i,{ref:j,makeDefault:!0,position:x})]})}function ModelViewer(e){let t=(0,s.D)(a.w,e.url),[r,c]=(0,n.useState)();return t.material.size=2.5,(0,n.useEffect)(()=>{c(new u.Box3().setFromObject(t).getSize(new u.Vector3))},[t]),(0,i.jsxs)(o.Xz,{className:"w-screen",style:{height:"100vh"},shadows:!0,children:[(0,i.jsx)(Model,{pcd:t,size:r,currentTime:e.currentTime,view:e.view}),(0,i.jsx)(l.z,{enablePan:!1})]})}var f=r(2385);let useWavesurfer=(e,t)=>{let[r,i]=(0,n.useState)();return(0,n.useEffect)(()=>{if(!e.current)return;let r=f.Z.create({...t,container:e.current});return i(r),()=>{r.destroy()}},[t,e]),r};function WaveSurferPlayer(e){let t=(0,n.useRef)(),[r,l]=(0,n.useState)(!1),[s,o]=(0,n.useState)(0),u=useWavesurfer(t,e);return(0,n.useEffect)(()=>{if(!u)return;o(0),l(!1);let t=[u.on("play",()=>l(!0)),u.on("pause",()=>l(!1)),u.on("timeupdate",t=>{o(t),e.currentTime.current=t})];return()=>{t.forEach(e=>e())}},[e.currentTime,u]),(0,i.jsx)("div",{ref:t,style:{minHeight:"120px"}})}function ToolOverlay(e){return(0,i.jsxs)("div",{className:"absolute bottom-10 w-full p-5 flex flex-row gap-10 justify-center items-center rounded-lg",children:[(0,i.jsx)("div",{className:"w-screen pl-10 ",children:(0,i.jsx)(WaveSurferPlayer,{height:60,waveColor:"rgb(125, 25, 25)",progressColor:"rgb(255, 0, 0)",url:e.url,container:"",barHeight:1,barWidth:4,barGap:2,barAlign:"bottom",barRadius:2.5,mediaControls:!0,normalize:!1,currentTime:e.currentTime})}),(0,i.jsxs)("select",{onChange:t=>{e.view.current=t.target.value},defaultValue:"select",className:"select text-lg max-w-xs bg-black text-white h-full pr-10",children:[(0,i.jsx)("option",{value:"select",disabled:!0,children:"Select view"}),(0,i.jsx)("option",{value:"top",children:"Top"}),(0,i.jsx)("option",{value:"bottom",children:"Bottom"}),(0,i.jsx)("option",{value:"side",children:"Side"}),(0,i.jsx)("option",{value:"free",children:"Free View"})]})]})}function Sonification(e){let{params:t}=e,r=(0,n.useRef)(0),[l,s]=(0,n.useState)(""),[o,u]=(0,n.useState)("");(0,n.useRef)();let a=(0,n.useRef)("");return(0,n.useEffect)(()=>{let getFileUrls=async()=>{let e=await fetch("/api/".concat(t.id)),r=await e.json();return r};getFileUrls().then(e=>{s(e.modelFileUrl),u(e.soundFileUrl)})},[t.id]),(0,i.jsx)(i.Fragment,{children:l&&o?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ModelViewer,{view:a,currentTime:r,url:l}),(0,i.jsx)(ToolOverlay,{view:a,currentTime:r,url:o})]}):(0,i.jsx)("div",{className:"container min-h-screen flex items-center justify-center",children:(0,i.jsx)("span",{className:"loading loading-dots loading-lg"})})})}}},function(e){e.O(0,[191,689,447,784,971,864,744],function(){return e(e.s=8910)}),_N_E=e.O()}]);